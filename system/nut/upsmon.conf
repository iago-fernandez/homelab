# Network UPS Tools: Monitor & Shutdown Controller

# Monitor Configuration
# System: myups@localhost (Local UPS daemon)
# Power Value: 1 (UPS feeds this system)
# User: upsmon_user (Defined in upsd.users)
# Type: primary (This system controls the shutdown)
MONITOR myups@localhost 1 upsmon_user <REDACTED> primary

# Minimum power supplies required to run
MINSUPPLIES 1

# Shutdown Command
# 1. Stop the Docker stack gracefully to prevent database corruption.
# 2. Halt the system.
SHUTDOWNCMD "docker compose -f /home/<user>/homelab/docker/docker-compose.yml down && /sbin/shutdown -h +0"

# Polling frequency (seconds)
POLLFREQ 5
POLLFREQALERT 5

# Interval to wait before declaring a stale UPS "dead" (15s)
DEADTIME 15

# Flag file for forcing UPS shutdown
POWERDOWNFLAG /etc/killpower

# Notification Warning Times (seconds)
# Replace battery warning: 12 hours
RBWARNTIME 43200
# No communication warning: 5 minutes
NOCOMMWARNTIME 300

# Final delay before executing SHUTDOWNCMD
FINALDELAY 5